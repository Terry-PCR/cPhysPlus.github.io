<!DOCTYPE html>
<html>
<head>
    <title>Exoplanet System Viewer</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: sans-serif; color: white; background-color: #111; }
        .container { display: flex; flex-direction: column; align-items: center; }
        .plot-container { width: 80%; display: flex; justify-content: space-around; }
        .dropdown-container { margin-bottom: 20px; }
        label { margin-right: 10px; }
        #starSelector { padding: 8px; border: 1px solid #555; background-color: #333; color: white; }
        .info-text { margin-top: 20px; width: 80%; text-align: left; line-height: 1.5; font-size: 14px; color: #ccc; }
    </style>
</head>
<body>
    <div class="container">
        <div class="dropdown-container">
            <label for="starSelector">Select Star:</label>
            <select id="starSelector" onchange="updateStarSystem(this.value)">
                </select>
        </div>
        <div class="plot-container">
            <div id="orbitalPlot"></div>
            <div id="temperaturePlot"></div>
        </div>
        <div class="info-text" id="plotInfo">
            <p><b>Teff:</b> Theoretical average surface temperature of a Star.</p>
            <p><b>Teq:</b> Temperature of a planet in radiative equilibrium.</p>
            <p><b>Ts:</b> Real temperature measured at the planet's surface.</p>
            <p><b>To:</b> Temperature considering a perfect black body.</p>
            <p><b>Note:</b> The vertical lines represent differences between Teq and Ts for each planet.</p>
        </div>
    </div>

    <script>
        // Constants (using JavaScript's 'const')
        const sigma = 5.67e-8; // Stefan-Boltzmann constant [W/m^2/K^4]
        const L_sun = 3.828e26; // Solar Luminosity [W]
        const UA = 1.496e11;     // Astronomical Unit [m]
        const R_sun_AU = 0.00465; // Solar Radius in AU

        // Star data (JavaScript object)
        const starsData = {
            'Sun-G': {
                'T_eff': 5778,
                'R_star': 1,
                'L_star': 1.0,
                'color': 'yellow',
                'planets': {
                    'Earth': {'a': 1.0, 'e': 0.017, 'color': 'cyan', 'Albedo': 0.294, 'g': 0.384},
                    'Venus': {'a': 0.723, 'e': 0.007, 'color': 'orange', 'Albedo': 0.77, 'g': 0.991},
                    'Marth': {'a': 1.524, 'e': 0.093, 'color': 'red', 'Albedo': 0.25, 'g': 0.085}
                }
            },
            'Proxima Centauri-M': {
                'R_star': 0.154,
                'T_eff': 3042,
                'L_star': 0.0017,
                'color': 'red',
                'planets': {
                    'PrÃ³xima b': {'a': 0.0485, 'e': 0.02, 'color': 'teal'}
                }
            },
            'Kepler-90-G': {
                'R_star': 1.2,
                'T_eff': 6080,
                'L_star': 1.7,
                'color': 'gold',
                'planets': {
                    'Kepler-90b': {'a': 0.074, 'e': 0, 'color': 'skyblue'},
                    'Kepler-90c': {'a': 0.089, 'e': 0, 'color': 'lightgreen'},
                    'Kepler-90i': {'a': 0.12, 'e': 0, 'color': 'lightgray'},
                    'Kepler-90d': {'a': 0.32, 'e': 0, 'color': 'salmon'},
                    'Kepler-90e': {'a': 0.42, 'e': 0, 'color': 'gold'},
                    'Kepler-90f': {'a': 0.48, 'e': 0, 'color': 'darkorange'},
                    'Kepler-90g': {'a': 0.71, 'e': 0, 'color': 'tomato'},
                    'Kepler-90h': {'a': 1.01, 'e': 0, 'color': 'goldenrod'}
                }
            }
        };

        // Populate the dropdown
        const starSelector = document.getElementById('starSelector');
        for (const starName in starsData) {
            const option = document.createElement('option');
            option.value = starName;
            option.textContent = starName;
            starSelector.appendChild(option);
        }

        function calculateOrbit(a, e) {
            const theta = Array.from(Array(1000).keys()).map(i => (2 * Math.PI * i) / 1000);
            const r = theta.map(t => (a * (1 - e**2)) / (1 + e * Math.cos(t)));
            const x = r.map((radius, i) => radius * Math.cos(theta[i]));
            const y = r.map((radius, i) => radius * Math.sin(theta[i]));
            return { x: x, y: y };
        }

        function habitableZoneBorders(L_star) {
            const r_min = 0.95 * Math.sqrt(L_star);
            const r_max = 1.37 * Math.sqrt(L_star);
            return { min: r_min, max: r_max };
        }

        function temperatureProfile(L_star, R_star) {
            const R_star_UA = R_star * R_sun_AU;
            const r_UA = Array.from(Array(10000).keys()).map(i => R_star_UA + (9 - R_star_UA) * i / 9999);
            const r_m = r_UA.map(r => r * UA);
            const T_r = r_m.map(rm => Math.pow((L_star * L_sun) / (16 * Math.PI * sigma * rm**2), 0.25));
            return { r_UA: r_UA, T_r: T_r };
        }

        function planetTemperatures(L_star, planet) {
            if (planet.Albedo === undefined || planet.g === undefined) {
                return { Teq: null, Ts: null };
            }
            const a_m = planet.a * UA;
            const A = planet.Albedo;
            const g = planet.g;
            const Teq = Math.pow(((1 - A) * L_star * L_sun) / (16 * Math.PI * sigma * a_m**2), 0.25);
            const Ts = Teq * Math.pow(1 / (1 - g), 0.25);
            return { Teq: Teq, Ts: Ts };
        }

        function planetTo(L_star, planet) {
            const a_m = planet.a * UA;
            const To = Math.pow((L_star * L_sun) / (16 * Math.PI * sigma * a_m**2), 0.25);
            return To;
        }

        function updateStarSystem(starName) {
            const star = starsData[starName];
            const hz = habitableZoneBorders(star.L_star);
            const tempProfile = temperatureProfile(star.L_star, star.R_star);
            const orbitalData = [];
            const tempTraces = [];
            const planetTempPoints = [];

            // Orbital Plot
            orbitalData.push({
                x: [0],
                y: [0],
                mode: 'markers',
                marker: { size: 15, color: star.color },
                name: starName
            });
            orbitalData.push({
                type: 'circle',
                x0: 0,
                y0: 0,
                r: hz.max,
                fillcolor: 'rgba(0,255,0,0.3)',
                line: { color: 'green' },
                name: 'Habitable Zone'
            });
            orbitalData.push({
                type: 'circle',
                x0: 0,
                y0: 0,
                r: hz.min,
                fillcolor: 'rgba(0,0,0,1)',
                line: { color: 'black' },
                name: ''
            });

            for (const planetName in star.planets) {
                const planet = star.planets[planetName];
                const orbit = calculateOrbit(planet.a, planet.e);
                orbitalData.push({
                    x: orbit.x,
                    y: orbit.y,
                    mode: 'lines',
                    line: { color: planet.color },
                    name: planetName
                });
            }

            const orbitalLayout = {
                title: `System: ${starName}`,
                xaxis: { title: 'Distance [AU]', zeroline: false },
                yaxis: { title: 'Distance [AU]', zeroline: false, scaleanchor: "x", scaleratio: 1 },
                shapes: orbitalData.filter(trace => trace.type === 'circle'),
                legend: { x: 1, y: 1, xanchor: 'right', yanchor: 'top' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('orbitalPlot', orbitalData.filter(trace => trace.mode === 'markers' || trace.mode === 'lines'), orbitalLayout);

            // Temperature Plot
            tempTraces.push({
                x: tempProfile.r_UA,
                y: tempProfile.T_r,
                mode: 'lines',
                line: { color: 'orange' },
                name: 'T(r)'
            });
            tempTraces.push({
                type: 'scatter',
                x: [hz.min, hz.max, hz.max, hz.min, hz.min],
                y: [100, 100, star.T_eff, star.T_eff, 100],
                fill: 'toself',
                fillcolor: 'rgba(0,255,0,0.3)',
                line: { color: 'rgba(0,0,0,0)' },
                name: 'Habitable Zone'
            });

            for (const planetName in star.planets) {
                const planet = star.planets[planetName];
                const temps = planetTemperatures(star.L_star, planet);
                const toTemp = planetTo(star.L_star, planet);
                if (temps.Teq !== null && temps.Ts !== null) {
                    tempTraces.push({
                        x: [planet.a, planet.a],
                        y: [temps.Teq, temps.Ts],
                        mode: 'lines',
                        line: { color: 'blue', width: 2 },
                        name: `${planetName} Teq-Ts`
                    });
                    tempTraces.push({
                        x: [planet.a],
                        y: [temps.Teq],
                        mode: 'markers',
                        marker: { color: 'white' },
                        name: `${planetName} Teq = ${temps.Teq.toFixed(0)}K`
                    });
                    tempTraces.push({
                        x: [planet.a],
                        y: [temps.Ts],
                        mode: 'markers',
                        marker: { color: 'red' },
                        name: `${planetName} Ts = ${temps.Ts.toFixed(0)}K`
                    });
                }
                tempTraces.push({
                    x: [planet.a],
                    y: [toTemp],
                    mode: 'markers',
                    marker: { color: 'white', symbol: 'x' },
                    name: `${planetName} To = ${toTemp.toFixed(0)}K`
                });
                tempTraces.push({
                    x: [planet.a],
                    y: [toTemp],
                    mode: 'text',
                    text: [planetName],
                    textposition: 'bottom left',
                    name: '' // To hide from legend
                });
            }

            const tempLayout = {
                title: `Temperature profile: ${starName} (Teff = ${star.T_eff} K)`,
                xaxis: { title: 'Distance from the Star (AU)', type: 'linear', range: [star.R_star * R_sun_AU, 9] },
                yaxis: { title: 'Temperature (K)', type: 'log', range: [Math.log10(100), Math.log10(star.T_eff)] },
                grid: { rows: 1, columns: 1 },
                legend: { x: 1, y: 1, xanchor: 'right', yanchor: 'top' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)'
            };

            Plotly.newPlot('temperaturePlot', tempTraces, tempLayout);
        }

        // Initial call to display the default star system
        updateStarSystem(starSelector.value);
    </script>
</body>
</html>
